<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lugaz - Compara tu Ahorro</title>
    <link href="style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Lugaz</h1>
        <p class="slogan">Descubre tu potencial de ahorro en 30 segundos.</p>
        
        <div class="card" id="lead-card">
            <h2>Paso 1: ¿Dónde te enviamos los resultados?</h2>
            
            <form id="leadForm" 
                  action="https://script.google.com/macros/s/AKfycbyv5MchGwmmU2pG2hUJTVSRXOnbTSVHbExptdNWkTMUx58YTZylo2WkDP2M6wGojJdK/exec" 
                  method="POST" 
                  target="oculto">
                
                <input type="hidden" name="action" value="guardarLead"> 
                
                <input type="email" id="email" name="email" placeholder="Tu Email" required>
                <input type="tel" id="telefono" name="telefono" placeholder="Teléfono Móvil (ej: 6XX XX XX XX)" pattern="[0-9]{9}" required>
                
                <button type="submit" id="submitBtn">Comenzar Ahorro</button>
                <div id="estado" style="margin-top: 15px; color: #fbbf24; font-weight: 600;"></div>
            </form>
        </div>
    </div>
    
    <iframe name="oculto" id="oculto" style="display:none;" onload="redireccionar()"></iframe>
    
    <script>
        // Esta función se dispara cuando el iframe (destino del formulario) recibe la respuesta del script de Google.
        function redireccionar() {
            const estado = document.getElementById('estado');
            const email = document.getElementById('email').value;
            const iframe = document.getElementById('oculto');
            const submitBtn = document.getElementById('submitBtn');

            // Verificamos si la fuente del iframe contiene la URL del script (indicando que se ha enviado)
            // y que el campo de email no está vacío (para ignorar la carga inicial).
            if (iframe.src.includes('exec') && email.length > 0) {
                // Prevenimos que se ejecute la redirección si el usuario no ha puesto un email.
                if (email) {
                    estado.textContent = '✅ Datos guardados. Redirigiendo...';
                    submitBtn.disabled = true;
                    
                    // Redirige al Paso 2 (Tu página de factura, que se llama index.html)
                    // Usamos un pequeño retardo para que el usuario vea el mensaje de éxito
                    setTimeout(() => {
                        window.location.href = `index.html?email=${encodeURIComponent(email)}`;
                    }, 800); 
                } else {
                    // Si por alguna razón el email está vacío, devolvemos el control.
                    estado.textContent = '❌ Error. Email no válido.';
                    submitBtn.disabled = false;
                }
            }
        }
    </script>
</body>
</html>
